68K GAS  ExtRAMTest.s 			page 1


   1               	* Test External SRAM
   2               	* External SRAM on the RETRO-EP4CE15 card goes from 0x300000 to 0x3FFFFF (1 MB)
   3               	* External SRAM only supports 8-bit accesses
   4               	* TUTOR14 uses SRAM from 0x000000 to 0x000800
   5               	
   6               	RAMSTART	= 0x300000
   7               	RAMEND		= 0x3FFFFF
   8               	ACIASTAT	= 0x010041
   9               	ACIADATA	= 0x010043
  10               	
  11               	* Code follows
  12               	
  13 0000 0000 0000 		.ORG    0x001000
  13      0000 0000 
  13      0000 0000 
  13      0000 0000 
  13      0000 0000 
  14               	* CHECK FIRST LOCATION BY WRITING/READING 0x55/0xAA
  15               	STARTTEST:
  16 1000 207C 0030 		MOVE.L  #RAMSTART,%A0
  16      0000 
  17 1006 103C 0055 		MOVE.B  #0x55,%D0
  18 100a 1080      		MOVE.B	%D0,(%A0)
  19 100c 4E71      	    NOP
  20 100e 1210      	    MOVE.B	(%A0),%D1
  21 1010 B200      	    CMP.B   %D0,%D1
  22 1012 6600 008A 	    BNE     FAIL
  23 1016 103C 00AA 		MOVE.B  #0xAA,%D0
  24 101a 1080      		MOVE.B	%D0,(%A0)
  25 101c 4E71      	    NOP
  26 101e 1210      	    MOVE.B	(%A0),%D1
  27 1020 B200      	    CMP.B   %D0,%D1
  28 1022 6600 007A 	    BNE     FAIL
  29               	* WRITE INCREMENTING PATTERN
  30 1026 103C 0000 	    MOVE.B  #0X00,%D0
  31 102a 207C 0030 		MOVE.L  #RAMSTART,%A0
  31      0000 
  32 1030 227C 0040 		MOVE.L  #RAMEND+1,%A1
  32      0000 
  33               	CHKBLKS:
  34 1036 10C0      	    MOVE.B  %D0,(%A0)+
  35 1038 B3C8      	    CMP.L   %A0,%A1
  36 103a 6700 000A 	    BEQ     DONEFILL
  37 103e 0600 0001 	    ADDI.B  #0x01,%D0
  38 1042 6000 FFF2 	    BRA     CHKBLKS
  39               	DONEFILL:
  40               	* READ BACK INCREMENTING PATTERN 
  41 1046 103C 0000 	    MOVE.B  #0X00,%D0
  42 104a 207C 0030 		MOVE.L  #RAMSTART,%A0
  42      0000 
  43 1050 227C 0040 		MOVE.L  #RAMEND+1,%A1
  43      0000 
  44               	LOOPCHK:
  45 1056 1218      	    MOVE.B  (%A0)+,%D1
  46 1058 B200      	    CMP.B   %D0,%D1
  47 105a 6600 0042 	    BNE     FAIL
  48 105e B3C8      	    CMP.L   %A0,%A1
68K GAS  ExtRAMTest.s 			page 2


  49 1060 6700 000A 	    BEQ     DONECHK
  50 1064 0600 0001 	    ADDI.B  #0x01,%D0
  51 1068 6000 FFEC 	    BRA     LOOPCHK
  52               	DONECHK:
  53               	* PRINT 'Pass'
  54 106c 103C 000A 		MOVE.B	#0x0A,%D0
  55 1070 4EBA 005E 		JSR     OUTCHAR
  56 1074 103C 000D 		MOVE.B	#0x0D,%D0
  57 1078 4EBA 0056 		JSR     OUTCHAR
  58 107c 103C 0050 		MOVE.B	#'P',%D0
  59 1080 4EBA 004E 		JSR     OUTCHAR
  60 1084 103C 0061 		MOVE.B	#'a',%D0
  61 1088 4EBA 0046 		JSR     OUTCHAR
  62 108c 103C 0073 		MOVE.B	#'s',%D0
  63 1090 4EBA 003E 		JSR     OUTCHAR
  64 1094 103C 0073 		MOVE.B	#'s',%D0
  65 1098 4EBA 0036 		JSR     OUTCHAR
  66 109c 4E75      	    RTS
  67               	FAIL:
  68               	* PRINT 'Fail'
  69 109e 103C 000A 		MOVE.B	#0x0A,%D0
  70 10a2 4EBA 002C 		JSR     OUTCHAR
  71 10a6 103C 000D 		MOVE.B	#0x0D,%D0
  72 10aa 4EBA 0024 		JSR     OUTCHAR
  73 10ae 103C 0046 		MOVE.B	#'F',%D0
  74 10b2 4EBA 001C 		JSR     OUTCHAR
  75 10b6 103C 0061 		MOVE.B	#'a',%D0
  76 10ba 4EBA 0014 		JSR     OUTCHAR
  77 10be 103C 0069 		MOVE.B	#'i',%D0
  78 10c2 4EBA 000C 		JSR     OUTCHAR
  79 10c6 103C 006C 		MOVE.B	#'l',%D0
  80 10ca 4EBA 0004 		JSR     OUTCHAR
  81 10ce 4E75      		RTS
  82               	
  83               	* OUTPUT A CHARACTER IN D0 TO THE ACIA
  84               	OUTCHAR:
  85 10d0 6100 000C 	    BSR     WAITRDY
  86 10d4 43F9 0001 	    LEA     ACIADATA,%A1
  86      0043 
  87 10da 1280      		MOVE.B	%D0,(%A1)
  88 10dc 4E75      	    RTS
  89               	
  90               	* WAIT FOR THE SERIAL PORT TO BE READY
  91               	WAITRDY:
  92 10de 43F9 0001 		LEA     ACIASTAT,%A1
  92      0041 
  93               	LOOPRDY:
  94 10e4 1211      		MOVE.B	(%A1),%D1
  95 10e6 0201 0002 		ANDI.B	#0x2,%D1
  96 10ea 6700 FFF8 		BEQ		LOOPRDY
  97 10ee 4E75      	    RTS
  98               	
68K GAS  ExtRAMTest.s 			page 3


DEFINED SYMBOLS
        ExtRAMTest.s:6      *ABS*:0000000000300000 RAMSTART
        ExtRAMTest.s:7      *ABS*:00000000003fffff RAMEND
        ExtRAMTest.s:8      *ABS*:0000000000010041 ACIASTAT
        ExtRAMTest.s:9      *ABS*:0000000000010043 ACIADATA
        ExtRAMTest.s:15     .text:0000000000001000 STARTTEST
        ExtRAMTest.s:67     .text:000000000000109e FAIL
        ExtRAMTest.s:33     .text:0000000000001036 CHKBLKS
        ExtRAMTest.s:39     .text:0000000000001046 DONEFILL
        ExtRAMTest.s:44     .text:0000000000001056 LOOPCHK
        ExtRAMTest.s:52     .text:000000000000106c DONECHK
        ExtRAMTest.s:84     .text:00000000000010d0 OUTCHAR
        ExtRAMTest.s:91     .text:00000000000010de WAITRDY
        ExtRAMTest.s:93     .text:00000000000010e4 LOOPRDY

NO UNDEFINED SYMBOLS
